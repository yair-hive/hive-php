<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="front_end/style.css">
    <script src="front_end/lib/jquery.min.js"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            const parsedUrl = new URL(window.location.href)
            const map_name = parsedUrl.searchParams.get("map_name")
            $.ajax({
                type: "POST", 
                url: "http://localhost/hive-php/api.php",
                data: "action=get_guest_seat_num&map_name="+map_name,
                success: function(msg){
                    belongs_list = JSON.parse(msg)   
                    var list_table = $('<table>').attr('id', 'list_table')                
                    var tr = $('<tr>')
                    .append($('<th>').text('מספר כיסא'))
                    .append($('<th>').text('שיעור')) 
                    .append($('<th>').text('שם פרטי'))
                    .append($('<th>').text('שם משפחה'))
                    $(list_table).append(tr)
                    for(let bel of belongs_list){ 
                        var tr = $('<tr>')
                        .append($('<td>').text(bel.seat_num))
                        .append($('<td>').text(bel.guest_group)) 
                        .append($('<td>').text(bel.guest_first_name))
                        .append($('<td>').text(bel.guest_last_name))                      
                        $(list_table).append(tr)
                    }
                    $('#mainBord').append(list_table)
                }
            });
            $('#export').click(function(){
                var html_string = $(list_table).html()
                $.ajax({
                    type: "POST", 
                    url: "http://localhost/hive-php/api.php",
                    data: "action=export_to_exel&htmlString="+html_string,
                    success: function(msg){
                        window.location.href = "http://localhost/hive-php/uploads/write.xls";
                    }
                })
            })

        });
    </script>
    <title> hive | maps </title>
</head>
<body>
    <div id="content">
        <div id="topBar">
            <a href="http://localhost/hive-php/maps.html" class="hive-button"> מפות </a>
            <a href="http://localhost/hive-php/import_guests.php" class="hive-button"> ייבא בחורים </a>
        </div>
        <div id="mainBord"></div>
        <div id="mneu">
            <div id='export' class='hive-button'> export </div>
        </div>
    </div>
</body>
</html>