/*! @viselect/vanilla 3.1.1 MIT | https://github.com/Simonwep/selection */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).SelectionArea=e()}(this,(function(){"use strict";const t=(t,e="px")=>"number"==typeof t?t+e:t;function e({style:e},s,i){if("object"==typeof s)for(const[i,o]of Object.entries(s))e[i]=t(o);else void 0!==i&&(e[s]=t(i))}function s(t){return(e,s,i,o={})=>{e instanceof HTMLCollection||e instanceof NodeList?e=Array.from(e):Array.isArray(e)||(e=[e]),Array.isArray(s)||(s=[s]);for(const n of e)for(const e of s)n[t](e,i,{capture:!1,...o});return[e,s,i,o]}}const i=s("addEventListener"),o=s("removeEventListener"),n=t=>{const e=t.touches&&t.touches[0]||t;return{tap:e,x:e.clientX,y:e.clientY,target:e.target}};function h(t){let e=t.path||t.composedPath&&t.composedPath();if(e)return e;let s=t.target.parentElement;for(e=[t.target,s];s=s.parentElement;)e.push(s);return e.push(document,window),e}function r(t,e,s="touch"){switch(s){case"center":{const s=e.left+e.width/2,i=e.top+e.height/2;return s>=t.left&&s<=t.right&&i>=t.top&&i<=t.bottom}case"cover":return e.left>=t.left&&e.top>=t.top&&e.right<=t.right&&e.bottom<=t.bottom;case"touch":return t.right>=e.left&&t.left<=e.right&&t.bottom>=e.top&&t.top<=e.bottom;default:throw new Error(`Unkown intersection mode: ${s}`)}}function c(t,e=document){const s=Array.isArray(t)?t:[t];let i=[];for(let t=0,o=s.length;t<o;t++){const o=s[t];"string"==typeof o?i=i.concat(Array.from(e.querySelectorAll(o))):o instanceof Element&&i.push(o)}return i}const l=(t,e)=>{for(const[s,i]of Object.entries(t)){const o=e[s];t[s]=void 0===o?t[s]:"object"!=typeof o||"object"!=typeof i||null===i||Array.isArray(i)?o:l(i,o)}return t},{abs:a,max:u,min:d,ceil:f}=Math;class SelectionArea extends class{constructor(){this.t=new Map,this.on=this.addEventListener,this.off=this.removeEventListener,this.emit=this.dispatchEvent}addEventListener(t,e){const s=this.t.get(t)||new Set;return this.t.set(t,s),s.add(e),this}removeEventListener(t,e){return this.t.get(t)?.delete(e),this}dispatchEvent(t,...e){let s=!0;for(const i of this.t.get(t)||[])s=!1!==i(...e)&&s;return s}unbindAllListeners(){this.t.clear()}}{constructor(t){super(),this.i={stored:[],selected:[],touched:[],changed:{added:[],removed:[]}},this.o=[],this.h=new DOMRect,this.l={y1:0,x2:0,y2:0,x1:0},this.u=!0,this.p=!0,this.m=!1,this.v={x:0,y:0},this.g={x:0,y:0},this.disable=this._.bind(this,!1),this.enable=this._,this.S=l({selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,behaviour:{overlap:"invert",intersect:"touch",startThreshold:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,startScrollMargins:{x:0,y:0}}},features:{range:!0,touch:!0,singleTap:{allow:!0,intersect:"native"}},startAreas:["html"],boundaries:["html"],container:"body"},t);for(const t of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))"function"==typeof this[t]&&(this[t]=this[t].bind(this));const{document:s,selectionAreaClass:i,selectionContainerClass:o}=this.S;this.A=s.createElement("div"),this.T=s.createElement("div"),this.T.appendChild(this.A),this.A.classList.add(i),o&&this.T.classList.add(o),e(this.A,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),e(this.T,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this.L=(t=>{let e,s=-1,i=!1;return{next(...o){e=o,i||(i=!0,s=requestAnimationFrame((()=>{t(...e),i=!1})))},cancel(){cancelAnimationFrame(s),i=!1}}})((t=>{this.M(),this.j(),this.C("move",t),this.k()})),this.enable()}_(t=!0){const{document:e,features:s}=this.S,n=t?i:o;n(e,"mousedown",this.O),s.touch&&n(e,"touchstart",this.O,{passive:!1})}O(t,e=!1){const{x:s,y:o,target:l}=n(t),{S:a}=this,{document:u}=this.S,d=l.getBoundingClientRect(),f=c(a.startAreas,a.document),p=c(a.boundaries,a.document);this.$=p.find((t=>r(t.getBoundingClientRect(),d)));const m=h(t);if(!this.$||!f.find((t=>m.includes(t)))||!p.find((t=>m.includes(t))))return;if(!e&&!1===this.C("beforestart",t))return;this.l={x1:s,y1:o,x2:0,y2:0};const v=u.scrollingElement||u.body;this.g={x:v.scrollLeft,y:v.scrollTop},this.u=!0,this.clearSelection(!1),i(u,["touchmove","mousemove"],this.D,{passive:!1}),i(u,["mouseup","touchcancel","touchend"],this.F),i(u,"scroll",this.R)}q(t){const{singleTap:{intersect:e},range:s}=this.S.features,i=n(t);let o=null;if("native"===e)o=i.target;else if("touch"===e){this.resolveSelectables();const{x:t,y:e}=i;o=this.o.find((s=>{const{right:i,left:o,top:n,bottom:h}=s.getBoundingClientRect();return t<i&&t>o&&e<h&&e>n}))}if(!o)return;for(this.resolveSelectables();!this.o.includes(o);){if(!o.parentElement)return;o=o.parentElement}const{stored:h}=this.i;if(this.C("start",t),t.shiftKey&&h.length&&s){const t=this.H??h[0],[e,s]=4&t.compareDocumentPosition(o)?[o,t]:[t,o],i=[...this.o.filter((t=>4&t.compareDocumentPosition(e)&&2&t.compareDocumentPosition(s))),e,s];this.select(i)}else h.includes(o)&&(1===h.length||t.ctrlKey||h.every((t=>this.i.stored.includes(t))))?this.deselect(o):(this.H=o,this.select(o));this.C("stop",t)}D(t){const{container:s,document:h,behaviour:{startThreshold:r}}=this.S,{x1:l,y1:u}=this.l,{x:d,y:f}=n(t),p=typeof r;if("number"===p&&a(d+f-(l+u))>=r||"object"===p&&a(d-l)>=r.x||a(f-u)>=r.y){if(o(h,["mousemove","touchmove"],this.D,{passive:!1}),!1===this.C("beforedrag",t))return void o(h,["mouseup","touchcancel","touchend"],this.F);i(h,["mousemove","touchmove"],this.W,{passive:!1}),e(this.A,"display","block"),c(s,h)[0].appendChild(this.T),this.resolveSelectables(),this.u=!1,this.I=this.$.getBoundingClientRect(),this.p=this.$.scrollHeight!==this.$.clientHeight||this.$.scrollWidth!==this.$.clientWidth,this.p&&(i(h,"wheel",this.N,{passive:!1}),this.o=this.o.filter((t=>this.$.contains(t)))),this.U(),this.C("start",t),this.W(t)}this.B(t)}U(){const{T:t,$:s,A:i}=this,o=this.I=s.getBoundingClientRect();this.p?(e(t,{top:o.top,left:o.left,width:o.width,height:o.height}),e(i,{marginTop:-o.top,marginLeft:-o.left})):(e(t,{top:0,left:0,width:"100%",height:"100%"}),e(i,{marginTop:0,marginLeft:0}))}W(t){const{x:e,y:s}=n(t),{v:i,l:o,S:h,L:r}=this,{speedDivider:c}=h.behaviour.scrolling,l=this.$;if(o.x2=e,o.y2=s,this.p&&!this.m&&(i.y||i.x)){this.m=!0;const e=()=>{if(i.x||i.y){if(i.y){const t=f(i.y/c);l.scrollTop+=t,o.y1-=t}if(i.x){const t=f(i.x/c);l.scrollLeft+=t,o.x1-=t}r.next(t),requestAnimationFrame(e)}else this.m=!1};requestAnimationFrame(e)}else r.next(t);this.B(t)}B(t){const{features:e}=this.S;(e.touch&&matchMedia("(hover: none), (pointer: coarse)").matches||this.p&&"safari"in window)&&t.preventDefault()}R(){const{g:t,S:{document:e}}=this,{scrollTop:s,scrollLeft:i}=e.scrollingElement||e.body;this.l.x1+=t.x-i,this.l.y1+=t.y-s,t.x=i,t.y=s,this.U(),this.L.next(null)}N(t){const{manualSpeed:e}=this.S.behaviour.scrolling,s=t.deltaY?t.deltaY>0?1:-1:0,i=t.deltaX?t.deltaX>0?1:-1:0;this.v.y+=s*e,this.v.x+=i*e,this.W(t),t.preventDefault()}M(){const{v:t,l:e,h:s,$:i,S:o}=this,{scrollTop:n,scrollHeight:h,clientHeight:r,scrollLeft:c,scrollWidth:l,clientWidth:f}=i,p=this.I,{x1:m,y1:v}=e;let{x2:y,y2:g}=e;const{behaviour:{scrolling:{startScrollMargins:_}}}=o;y<p.left+_.x?(t.x=c?-a(p.left-y+_.x):0,y=y<p.left?p.left:y):y>p.right-_.x?(t.x=l-c-f?a(p.left+p.width-y-_.x):0,y=y>p.right?p.right:y):t.x=0,g<p.top+_.y?(t.y=n?-a(p.top-g+_.y):0,g=g<p.top?p.top:g):g>p.bottom-_.y?(t.y=h-n-r?a(p.top+p.height-g-_.y):0,g=g>p.bottom?p.bottom:g):t.y=0;const b=d(m,y),x=d(v,g),w=u(m,y),S=u(v,g);s.x=b,s.y=x,s.width=w-b,s.height=S-x}k(){const{x:t,y:e,width:s,height:i}=this.h,{style:o}=this.A;o.left=`${t}px`,o.top=`${e}px`,o.width=`${s}px`,o.height=`${i}px`}F(t,s){const{document:i,features:n}=this.S,{u:h}=this;o(i,["mousemove","touchmove"],this.D),o(i,["touchmove","mousemove"],this.W),o(i,["mouseup","touchcancel","touchend"],this.F),o(i,"scroll",this.R),this.G(),t&&h&&n.singleTap.allow?this.q(t):h||s||(this.j(),this.C("stop",t)),this.v.x=0,this.v.y=0,this.p&&o(i,"wheel",this.N,{passive:!0}),this.T.remove(),this.L?.cancel(),e(this.A,"display","none")}j(){const{o:t,S:e,i:s,h:i}=this,{stored:o,selected:n,touched:h}=s,{intersect:c,overlap:l}=e.behaviour,a="invert"===l,u=[],d=[],f=[];for(let e=0;e<t.length;e++){const s=t[e];if(r(i,s.getBoundingClientRect(),c)){if(n.includes(s))o.includes(s)&&!h.includes(s)&&h.push(s);else{if(a&&o.includes(s)){f.push(s);continue}d.push(s)}u.push(s)}}a&&d.push(...o.filter((t=>!n.includes(t))));const p="keep"===l;for(let t=0;t<n.length;t++){const e=n[t];u.includes(e)||p&&o.includes(e)||f.push(e)}s.selected=u,s.changed={added:d,removed:f},this.H=u[u.length-1]}C(t,e){return this.emit(t,{event:e,store:this.i,selection:this})}G(){const{S:t,i:e}=this,{selected:s,changed:i,touched:o,stored:n}=e,h=s.filter((t=>!n.includes(t)));switch(t.behaviour.overlap){case"drop":e.stored=[...h,...n.filter((t=>!o.includes(t)))];break;case"invert":e.stored=[...h,...n.filter((t=>!i.removed.includes(t)))];break;case"keep":e.stored=[...n,...s.filter((t=>!n.includes(t)))]}}trigger(t,e=!0){this.O(t,e)}resolveSelectables(){this.o=c(this.S.selectables,this.S.document)}clearSelection(t=!0){this.i={stored:t?[]:this.i.stored,selected:[],touched:[],changed:{added:[],removed:[]}}}getSelection(){return this.i.stored}getSelectionArea(){return this.A}cancel(t=!1){this.F(null,!t)}destroy(){this.cancel(),this.disable(),this.T.remove(),super.unbindAllListeners()}select(t,e=!1){const{changed:s,selected:i,stored:o}=this.i,n=c(t,this.S.document).filter((t=>!i.includes(t)&&!o.includes(t)));return o.push(...n),i.push(...n),s.added.push(...n),s.removed=[],e||(this.C("move",null),this.C("stop",null)),n}deselect(t,e=!1){const{selected:s,stored:i,changed:o}=this.i,n=c(t,this.S.document).filter((t=>s.includes(t)||i.includes(t)));return!!n.length&&(this.i.stored=i.filter((t=>!n.includes(t))),this.i.selected=s.filter((t=>!n.includes(t))),this.i.changed.added=[],this.i.changed.removed.push(...n.filter((t=>!o.removed.includes(t)))),e||(this.C("move",null),this.C("stop",null)),!0)}}return SelectionArea.version="3.1.1",SelectionArea}));
//# sourceMappingURL=viselect.cjs.js.map